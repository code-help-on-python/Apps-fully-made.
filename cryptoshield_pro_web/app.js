(()=>{"use strict";const A=new TextEncoder(),B=new TextDecoder(),C=A.encode("CSP1"),D=16,E=200000,F=i=>document.getElementById(i),G=q=>document.querySelectorAll(q),H=F("passphrase-decrypt"),I=F("token"),J=F("output"),K=F("status"),L=F("decrypt"),M=F("copy"),N=F("clear"),O=F("passphrase-encrypt"),P=F("plaintext"),Q=F("token-out"),R=F("status-encrypt"),S=F("encrypt"),T=F("copy-encrypt"),U=F("clear-encrypt"),V=G(".tab"),W=G(".tab-panel"),X=G(".theme-btn"),Y=G(".toggle-pass"),Z=F("about-open"),a0=F("about-close"),a1=F("modal-about"),a2=F("modal-first"),a3=F("first-accept"),a4=F("devtools-warning"),a5=F("origin-lock");
const a6=(t,e)=>{if(K){K.textContent=t;K.classList.remove("ok","err");e&&K.classList.add(e);}},a7=(t,e)=>{if(R){R.textContent=t;R.classList.remove("ok","err");e&&R.classList.add(e);}},a8=t=>{const e=t==="dark"?"dark":"light";document.body.dataset.theme=e;X.forEach(b=>b.classList.toggle("active",b.dataset.theme===e));try{localStorage.setItem("cryptoshield-theme",e);}catch(_){}};
const a9=s=>{const c=(s||"").replace(/\s+/g,""),b=c.replace(/-/g,"+").replace(/_/g,"/"),p=b.length%4===0?"":"=".repeat(4-b.length%4),r=atob(b+p),o=new Uint8Array(r.length);for(let i=0;i<r.length;i++)o[i]=r.charCodeAt(i);return o;};
const b0=x=>{let s="";for(let i=0;i<x.length;i++)s+=String.fromCharCode(x[i]);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"");};
const b1=x=>{let s="";for(let i=0;i<x.length;i++)s+=String.fromCharCode(x[i]);return s;};
const b2=(a,b)=>{if(a.length!==b.length)return!1;let d=0;for(let i=0;i<a.length;i++)d|=a[i]^b[i];return d===0;};
const b3=d=>{if(!d.length)throw new Error("Invalid padding.");const p=d[d.length-1];if(p<1||p>16)throw new Error("Invalid padding.");for(let i=d.length-p;i<d.length;i++)if(d[i]!==p)throw new Error("Invalid padding.");return d.slice(0,d.length-p);};
const b4=d=>{const p=16-(d.length%16),o=new Uint8Array(d.length+p);o.set(d);o.fill(p,d.length);return o;};
const b5=async(p,s)=>{const w=A.encode(p),m=await crypto.subtle.importKey("raw",w,"PBKDF2",!1,["deriveBits"]),bits=await crypto.subtle.deriveBits({name:"PBKDF2",hash:"SHA-256",salt:s,iterations:E},m,256),k=new Uint8Array(bits);return{signingKey:k.slice(0,16),encryptionKey:k.slice(16,32)};};
const b6=async(k,d,e)=>{const h=await crypto.subtle.importKey("raw",k,{name:"HMAC",hash:"SHA-256"},!1,["sign"]),s=new Uint8Array(await crypto.subtle.sign("HMAC",h,d));return b2(s,e);};
const b7=async(k,i,c)=>{const key=await crypto.subtle.importKey("raw",k,{name:"AES-CBC"},!1,["decrypt"]),p=new Uint8Array(await crypto.subtle.decrypt({name:"AES-CBC",iv:i},key,c));return b3(p);};
const b8=t=>{if(t.length<57)throw new Error("Invalid token format.");const v=t[0];if(v!==128)throw new Error("Invalid token version.");const i=9,h=t.length-32,iv=t.slice(i,i+16),ct=t.slice(i+16,h),dt=t.slice(0,h),hm=t.slice(h);return{iv,ct,dt,hm};};
const b9=async(ek,sk,pt)=>{const iv=crypto.getRandomValues(new Uint8Array(16)),pd=b4(pt),k=await crypto.subtle.importKey("raw",ek,{name:"AES-CBC"},!1,["encrypt"]),ct=new Uint8Array(await crypto.subtle.encrypt({name:"AES-CBC",iv},k,pd)),ts=Math.floor(Date.now()/1000);let n=BigInt(ts);const tb=new Uint8Array(8);for(let i=7;i>=0;i--){tb[i]=Number(n&255n);n>>=8n;}const d=new Uint8Array(1+8+16+ct.length);d[0]=128;d.set(tb,1);d.set(iv,9);d.set(ct,25);const hk=await crypto.subtle.importKey("raw",sk,{name:"HMAC",hash:"SHA-256"},!1,["sign"]),hm=new Uint8Array(await crypto.subtle.sign("HMAC",hk,d)),tr=new Uint8Array(d.length+hm.length);tr.set(d);tr.set(hm,d.length);return b0(tr);};
const c0=async(p,pl)=>{if(!p)throw new Error("Passphrase is required.");if(!pl)throw new Error("Token is required.");const pb=a9(pl);if(pb.length<C.length+D+1)throw new Error("Invalid token format.");for(let i=0;i<C.length;i++)if(pb[i]!==C[i])throw new Error("Invalid token format.");const s=pb.slice(C.length,C.length+D),tb=pb.slice(C.length+D),ts=b1(tb),cands=[a9(ts),tb],k=await b5(p,s);let err=null;for(const tr of cands){try{const {iv,ct,dt,hm}=b8(tr),ok=await b6(k.signingKey,dt,hm);if(!ok)throw new Error("Wrong passphrase or corrupted token.");const pt=await b7(k.encryptionKey,iv,ct);return B.decode(pt);}catch(e){err=e;}}throw err||new Error("Wrong passphrase or corrupted token.");};
const c1=async(p,pt)=>{if(!p)throw new Error("Passphrase is required.");if(!pt)throw new Error("Plaintext is required.");const s=crypto.getRandomValues(new Uint8Array(D)),k=await b5(p,s),t=await b9(k.encryptionKey,k.signingKey,A.encode(pt)),tb=A.encode(t),pl=new Uint8Array(C.length+D+tb.length);pl.set(C,0);pl.set(s,C.length);pl.set(tb,C.length+D);return b0(pl);};
const c2=d=>{[L,M,S,T].forEach(x=>{if(x){x.disabled=!!d;x.setAttribute("aria-disabled",d?"true":"false");}});};
const ALLOWED_HOSTS=["<my-github-username>.github.io","localhost","127.0.0.1"],h=location.hostname,ok=ALLOWED_HOSTS.includes(h);
if(!ok){if(a5)a5.hidden=false;c2(!0);a6("This build is licensed for use only on the official host.","err");a7("This build is licensed for use only on the official host.","err");}
let dv=!1;const c3=()=>{if(!ok)throw new Error("This build is licensed for use only on the official host.");if(dv)throw new Error("Developer tools detected.");};
const c4=()=>{const w=Math.abs(window.outerWidth-window.innerWidth),hh=Math.abs(window.outerHeight-window.innerHeight),o=w>160||hh>160;if(o!==dv){dv=o;if(a4)a4.hidden=!o;if(ok)c2(o);}};
setInterval(c4,1000);window.addEventListener("resize",c4);document.addEventListener("contextmenu",e=>{e.preventDefault();});
V.forEach(btn=>{btn.addEventListener("click",()=>{V.forEach(b=>b.classList.remove("active"));W.forEach(p=>p.classList.remove("active"));btn.classList.add("active");const t=document.getElementById(`tab-${btn.dataset.tab}`);W.forEach(p=>{p.hidden=true;});if(t){t.hidden=false;t.classList.add("active");}});});
X.forEach(btn=>btn.addEventListener("click",()=>a8(btn.dataset.theme)));
Y.forEach(btn=>btn.addEventListener("click",()=>{const id=btn.dataset.target,i=F(id);if(!i)return;const h=i.type==="password";i.type=h?"text":"password";btn.textContent=h?"Hide":"Show";}));
if(Z&&a1)Z.addEventListener("click",()=>{a1.hidden=false;});
if(a0&&a1)a0.addEventListener("click",()=>{a1.hidden=true;});
if(a1)a1.addEventListener("click",e=>{if(e.target===a1)a1.hidden=true;});
let ack=!1;try{ack=localStorage.getItem("cs-legal-ack")==="1";}catch(_){}
if(a2&&!ack)a2.hidden=false;
if(a3)a3.addEventListener("click",()=>{if(a2)a2.hidden=true;try{localStorage.setItem("cs-legal-ack","1");}catch(_){}});
if(L)L.addEventListener("click",async()=>{a6("Decrypting...","");if(J)J.value="";if(L)L.disabled=true;try{c3();const res=await c0(H.value.trim(),I.value.trim());if(J)J.value=res;a6("Decrypted.","ok");}catch(e){const m=e instanceof Error?e.message:"Decryption failed.",low=m.toLowerCase();let s=m;if(low.includes("padding"))s="Wrong passphrase or corrupted token.";if(low.includes("token format")||low.includes("token version")||low.includes("magic"))s="Token does not match CryptoShield format.";a6(s,"err");}finally{if(L)L.disabled=false;if(ok)c2(dv);}});
if(M)M.addEventListener("click",async()=>{try{c3();if(!J||!J.value.trim()){a6("Nothing to copy.","err");return;}await navigator.clipboard.writeText(J.value);a6("Copied to clipboard.","ok");}catch(e){const m=e instanceof Error?e.message:"Copy failed.";a6(m,"err");}});
if(N)N.addEventListener("click",()=>{if(!ok)return;a6("Cleared.","");if(H)H.value="";if(I)I.value="";if(J)J.value="";});
if(S)S.addEventListener("click",async()=>{a7("Encrypting...","");if(Q)Q.value="";if(S)S.disabled=true;try{c3();const tok=await c1(O.value.trim(),P.value.trim());if(Q)Q.value=tok;a7("Encrypted.","ok");}catch(e){const m=e instanceof Error?e.message:"Encryption failed.";a7(m,"err");}finally{if(S)S.disabled=false;if(ok)c2(dv);}});
if(T)T.addEventListener("click",async()=>{try{c3();if(!Q||!Q.value.trim()){a7("Nothing to copy.","err");return;}await navigator.clipboard.writeText(Q.value);a7("Copied to clipboard.","ok");}catch(e){const m=e instanceof Error?e.message:"Copy failed.";a7(m,"err");}});
if(U)U.addEventListener("click",()=>{if(!ok)return;a7("Cleared.","");if(O)O.value="";if(P)P.value="";if(Q)Q.value="";});
let st="light";try{st=localStorage.getItem("cryptoshield-theme")||"light";}catch(_){st="light";}a8(st==="dark"?"dark":"light");
const active=document.querySelector(".tab.active");if(active)active.click();c4();})();
